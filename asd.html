<p id="dynamic" class="lg-text"></p>
<p class="sm-text"></p>

<script>
    let target = document.querySelector("#dynamic");

    function randomString() {
        let stringArr = ["Hi There!ğŸ‘‹", "ã¯ã˜ã‚ã¾ã—ã¦ï¼ğŸ‘‹", "ì•ˆë…•í•˜ì„¸ìš”!ğŸ‘‹"];
        let selectString =
            stringArr[Math.floor(Math.random() * stringArr.length)];
        let selectStringArr = selectString.split("");

        return selectStringArr;
    }

    //íƒ€ì´í•‘ ë¦¬ì…‹
    function resetTyping() {
        target.textContent = "";
        dynamic(randomString());
    }

    //í…ìŠ¤íŠ¸ í•œê¸€ì ì”© ì¶œë ¥ í•¨ìˆ˜
    function dynamic(randomArr) {
        if (randomArr.length > 0) {
            target.textContent += randomArr.shift();
            setTimeout(function () {
                dynamic(randomArr);
            }, 80);
        } else {
            setTimeout(resetTyping, 3000);
        }
    }

    //randomString ì˜†ì— ì†Œê´„í˜¸ ê¹Œë¨¹ì§€ ë§ê¸°(ì—†ìœ¼ë©´ ì‘ë™ ì•ˆë¨)
    dynamic(randomString());
    //ì»¤ì„œ ê¹œë¹¡ì„ íš¨ê³¼
    function blink() {
        target.classList.toggle("active");
    }
    setInterval(blink, 500);

    const getToken = () => {
        let cookieName = document.cookie
            .split("; ")
            .find((row) => row.startsWith("token="))
            ?.split("=")[1];
        return cookieName;
    };

    const updateLoginButton = (isLoggedIn) => {
        const navBtn = document.querySelector("#login-btn");
        const link = navBtn.querySelector("a");

        if (isLoggedIn) {
            link.href = "/auth/api/logout";
            link.textContent = "logout";
        } else {
            link.href = "/auth/login";
            link.textContent = "login";
        }
    };

    const getName = (token) => {
        const target = document.querySelector(".sm-text");

        if (!token) {
            target.textContent = "Do IT! WEB Project | anonymous";
            return;
        }
        const base64 = token
            .split(".")[1]
            .replace(/-/g, "+")
            .replace(/_/g, "/");
        const name = JSON.parse(
            decodeURIComponent(escape(window.atob(base64)))
        ).name;
        target.textContent = `Do IT! WEB Project | ${
            name ? name : "anonymous"
        }`;
    };

    window.onload = function () {
        const token = getToken();
        updateLoginButton(!!token);
        getName(token);
    };

    const link = document.querySelector("a");

    // link.addEventListener("click", (event) => {
    //     event.preventDefault(); // ê¸°ë³¸ ë™ì‘ ì¤‘ì§€

    //     // ë§í¬ ê°€ì ¸ì˜¤ê¸°
    //     const href = link.getAttribute("href");

    //     // í˜ì´ì§€ ì´ë™
    //     window.location.href = href;
    // });
</script>
